<!DOCTYPE html>

<html lang="en-us">
    <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="format-detection" content="telephone=no"/>

    <title>Getting start(5) : ペリフェラルの組み合わせでアプリケーションを作る | mimxrt_docs</title>
    
    <link rel="apple-touch-icon" sizes="180x180" href="/mimxrt_docs/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/mimxrt_docs/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/mimxrt_docs/favicon-16x16.png">
    <link rel="manifest" href="/mimxrt_docs/manifest.json">
    <link rel="mask-icon" href="/mimxrt_docs/safari-pinned-tab.svg" color="#FF3DB4">
    <meta name="theme-color" content="#ffffff">

    
    
    
    <link rel="stylesheet" href="https://takeshionagawa.github.io/mimxrt_docs/css/main.min.3d7b8d516fca9eae3aea72ddeb4c2e2134532361e88642f5b14aa9d381761e00.css"/>

    
    
    

    
    
 
    </head>

    <body>
        
<nav>
  <header>
    <div class="site-title">
        <a href="/mimxrt_docs/">mimxrt_docs</a>
    </div>  
</header>

  <div class="nav-menu">
  
    <a class="color-link nav-link" href="/mimxrt_docs/about/">About</a>
  
    <a class="color-link nav-link" href="/mimxrt_docs/tags/">Tags</a>
  
    <a class="color-link nav-link" href="/mimxrt_docs/archives/">Archives</a>
  
  <a class="color-link nav-link" href="https://takeshionagawa.github.io/mimxrt_docs/index.xml" target="_blank" rel="noopener" type="application/rss+xml">RSS</a>
</div>
<footer class="footer">
	<div class="social-icons">
        

    

    
    <a class="social-icon" href="https://twitter.com/onagawadosu" target="_blank" rel="noopener" title="Twitter">
        <svg width="28px" height="28px" viewBox="0 0 28 28" version="1.1" fill="#ABABAB" xmlns="https://www.w3.org/2000/svg" xmlns:xlink="https://www.w3.org/1999/xlink">
            <path d="M8.991284,24.971612 C19.180436,24.971612 24.752372,16.530224 24.752372,9.210524 C24.752372,8.970656 24.747512,8.731868 24.736496,8.494376 C25.818008,7.712564 26.758256,6.737 27.5,5.62622 C26.507372,6.067076 25.439252,6.364292 24.318752,6.498212 C25.462472,5.812628 26.340512,4.727444 26.754584,3.434036 C25.684088,4.068536 24.499004,4.53002 23.23724,4.778528 C22.226468,3.701876 20.786828,3.028388 19.193828,3.028388 C16.134404,3.028388 13.653536,5.509256 13.653536,8.567492 C13.653536,9.0023 13.702244,9.424904 13.797176,9.830552 C9.19346,9.599108 5.11106,7.39472 2.3792,4.04294 C1.903028,4.861364 1.629032,5.812628 1.629032,6.827072 C1.629032,8.74904 2.606972,10.445612 4.094024,11.438132 C3.185528,11.41016 2.331788,11.160464 1.585184,10.745096 C1.583888,10.768208 1.583888,10.791428 1.583888,10.815728 C1.583888,13.49888 3.493652,15.738584 6.028088,16.246508 C5.562932,16.373084 5.07326,16.44134 4.56782,16.44134 C4.210988,16.44134 3.863876,16.406024 3.526484,16.34144 C4.231724,18.542264 6.276596,20.143796 8.701412,20.18894 C6.805148,21.674696 4.416836,22.56008 1.821488,22.56008 C1.374476,22.56008 0.93362,22.534592 0.5,22.4834 C2.951708,24.054476 5.862524,24.971612 8.991284,24.971612"></path>
        </svg>
    </a>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
    
    
    <a class="social-icon" href="https://github.com/TakeshiOnagawa" target="_blank" rel="noopener" title="GitHub">
        <svg width="28px" height="28px" viewBox="0 0 28 28" version="1.1" fill="#ABABAB" xmlns="https://www.w3.org/2000/svg" xmlns:xlink="https://www.w3.org/1999/xlink">
            <path d="M13.9988029,1.32087331 C6.82105037,1.32087331 1,7.14112562 1,14.3212723 C1,20.0649109 4.72454649,24.9370678 9.89038951,26.6560892 C10.5408085,26.7757983 10.7778323,26.374374 10.7778323,26.0296121 C10.7778323,25.7215609 10.7666595,24.9035493 10.760275,23.8189856 C7.14426471,24.6042767 6.38131925,22.0760223 6.38131925,22.0760223 C5.78995672,20.5740732 4.93762853,20.1742451 4.93762853,20.1742451 C3.75729765,19.3682044 5.02701126,19.3841656 5.02701126,19.3841656 C6.33183953,19.4759425 7.01817121,20.7241085 7.01817121,20.7241085 C8.17775254,22.7104801 10.0611744,22.1366749 10.8017741,21.8038838 C10.919887,20.9643246 11.2558703,20.3913175 11.6269683,20.066507 C8.74038491,19.7385043 5.70536235,18.6228163 5.70536235,13.6413251 C5.70536235,12.2223743 6.21213051,11.0611968 7.04370914,10.1530044 C6.90963504,9.82420367 6.46351945,8.50181809 7.17139875,6.71256734 C7.17139875,6.71256734 8.26234691,6.36301702 10.7459099,8.04532771 C11.78259,7.75642995 12.8950858,7.61277914 14.000399,7.60719272 C15.1049142,7.61277914 16.2166119,7.75642995 17.2548881,8.04532771 C19.736855,6.36301702 20.8262071,6.71256734 20.8262071,6.71256734 C21.5356825,8.50181809 21.0895669,9.82420367 20.9562909,10.1530044 C21.7894656,11.0611968 22.2922435,12.2223743 22.2922435,13.6413251 C22.2922435,18.6355852 19.2524325,19.734514 16.3570705,20.0561322 C16.8231376,20.4575564 17.2389269,21.2508282 17.2389269,22.4638795 C17.2389269,24.2012564 17.2229657,25.603448 17.2229657,26.0296121 C17.2229657,26.3775663 17.4575954,26.7821827 18.116793,26.6552912 C23.2786458,24.9322794 27,20.0633148 27,14.3212723 C27,7.14112562 21.1789496,1.32087331 13.9988029,1.32087331"></path>
        </svg>
    </a>
    

    
    
    

    

    

    

    

    

</div>




	<p><a href="https://github.com/kimcc/hugo-theme-noteworthy" target="_blank" rel="noopener">Noteworthy theme</a></p>
	<p><a href="https://gohugo.io" target="_blank" rel="noopener">Built with Hugo</a></p>

	<script src="https://takeshionagawa.github.io/mimxrt_docs/js/main.min.fa5c2b23e07b5d9bfad267a52b4b24fdb053e6fb7524993383594926a3ac270c.js" integrity="sha256-+lwrI+B7XZv60melK0sk/bBT5vt1JJkzg1lJJqOsJww=" crossorigin="anonymous"></script>
</footer>
</nav>

        <div id="content" class="content-container">
        

<h1 class="post-title">Getting start(5) : ペリフェラルの組み合わせでアプリケーションを作る</h1>
    
    <time>June 5, 2020</time>
    
    <div>
        <p>
        <p>この記事は、Getting started with i.MXRT microcontroller (4)の続きです。</p>
<p>前回までの内容で以下に示すIDEのツール機能を学習した。</p>
<ul>
<li><font color="MediumBlue">Import SDK example機能</font></li>
<li><font color="MediumBlue">New project機能</font></li>
<li><font color="MediumBlue">MCUXpresso Config Tools Pins</font></li>
<li><font color="MediumBlue">MCUXpresso Config Tools Clocks</font></li>
<li><font color="MediumBlue">MCUXpresso Config Tools Peripherals</font></li>
</ul>
<p>今回は各種ツールを駆使し、ペリフェラル同士を組み合わせた一つのアプリケーションを作成します。<br>
今回行う内容をリストで示します。</p>
<ul>
<li>スイッチを押したらLEDがつく</li>
<li>再度スイッチを押したらLEDが消える</li>
<li>スイッチにはチャタリング対策を入れる</li>
</ul>
<p>一見簡単なように見えますが、GPIO入出力、タイマーを使ったチャタリング対策といったようにボリュームとしては十分かなと思います。</p>
<h1 id="新規プロジェクト作成とピンの設定">新規プロジェクト作成とピンの設定</h1>
<p>新規プロジェクトの作成を行います。(PITのドライバを選択する。)</p>
<p>プロジェクトウィザートでドライバを選択し忘れたり、あとから使いたいペリフェラルが増えるといったことがあると思います。<br>
まずプロジェクトエクスプローラー上でプロジェクトを選択します。<br>
次に、画像示すアイコンをクリックするとSDK manageのウィンドウが開きます。<br>
使いたいペリフェラルにチェックを入れてOK押すとプロジェクトにドライバの追加を行うことができます。</p>
<figure class="center">
    <img src="../../img/get_start29.png" width="100%" height="100%"/> 
</figure>

<p>プロジェクト作成とドライバの追加が完了したらピンの設定を行います。<br>
今回はスイッチもあるので2本のピンを設定する必要があります。(GPIO_11,GPIO_SD_05)</p>
<figure class="center">
    <img src="../../img/get_start30.png" width="100%" height="100%"/> 
</figure>

<p>ここで注意したいのが、スイッチのピン設定です。<br>
MIMXRT1010-EVKの場合はスイッチの反対側のピンはGNDにつながっているのでマイコン側はプルアップの設定にしておきます。<br>
このように設定を行うことでスイッチが押されたときにはピンの状態がLOWとなります。<br>
設定ができたらUpdate codeをクリックしコードを出力してください。</p>
<p>次にGPIOの入出力が正しく設定されているかテストコードを実行して確認します。</p>
<div class="highlight"><pre style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-c++" data-lang="c++"><span style="color:#078;font-weight:bold">int</span> <span style="color:#c0f">main</span>(<span style="color:#078;font-weight:bold">void</span>) {

  	<span style="color:#09f;font-style:italic">/* Init board hardware. */</span>
    BOARD_InitBootPins();
    BOARD_InitBootClocks();
    BOARD_InitBootPeripherals();
  	<span style="color:#09f;font-style:italic">/* Init FSL debug console. */</span>
    BOARD_InitDebugConsole();

    PRINTF(<span style="color:#c30">&#34;Hello World</span><span style="color:#c30;font-weight:bold">\n</span><span style="color:#c30">&#34;</span>);

    <span style="color:#09f;font-style:italic">/* Force the counter to be placed into memory. */</span>
    <span style="color:#069;font-weight:bold">volatile</span> <span style="color:#069;font-weight:bold">static</span> <span style="color:#078;font-weight:bold">int</span> i <span style="color:#555">=</span> <span style="color:#f60">0</span> ;
    <span style="color:#069;font-weight:bold">volatile</span> <span style="color:#078;font-weight:bold">int</span> state <span style="color:#555">=</span> <span style="color:#f60">0</span>;
    <span style="color:#09f;font-style:italic">/* Enter an infinite loop, just incrementing a counter. */</span>
    <span style="color:#069;font-weight:bold">while</span>(<span style="color:#f60">1</span>) {
        i<span style="color:#555">++</span> ;
        <span style="color:#09f;font-style:italic">/* &#39;Dummy&#39; NOP to allow source level single stepping of
</span><span style="color:#09f;font-style:italic">            tight while() loop */</span>
        <span style="color:#069;font-weight:bold">__asm</span> <span style="color:#069;font-weight:bold">volatile</span> (<span style="color:#c30">&#34;nop&#34;</span>);
        state <span style="color:#555">=</span> GPIO_PinRead(GPIO2,<span style="color:#f60">5</span>);<span style="color:#09f;font-style:italic">//スイッチの状態をスキャン
</span><span style="color:#09f;font-style:italic"></span>
        <span style="color:#069;font-weight:bold">if</span>(state <span style="color:#555">==</span> <span style="color:#f60">0</span>){
        	GPIO_PinWrite(GPIO1, <span style="color:#f60">11</span>, <span style="color:#f60">1</span>);<span style="color:#09f;font-style:italic">//押されていたらLEDがON
</span><span style="color:#09f;font-style:italic"></span>        }
        <span style="color:#069;font-weight:bold">else</span>{
        	GPIO_PinWrite(GPIO1, <span style="color:#f60">11</span>, <span style="color:#f60">0</span>);<span style="color:#09f;font-style:italic">//押されていなければLEDはOFF
</span><span style="color:#09f;font-style:italic"></span>        }
    }
    <span style="color:#069;font-weight:bold">return</span> <span style="color:#f60">0</span> ;
}
</code></pre></div><p>スイッチを押している間だけLEDが光ると思います。
<figure class="center">
    <img src="../../img/get_start31.png" width="100%" height="100%"/> 
</figure>
</p>
<p>こういった単機能でのテストは重要なので、必ず行いましょう。</p>
<h1 id="pitの設定">PITの設定</h1>
<p>次にタイマーのセットアップをしていこうと思います。
クロックは前回同様に12.5MHzに設定します。</p>
<p>Channel period/freqは、スイッチのスキャン周期を1kHzにしたいので1msに設定しました。<br>
その他の設定などは前回同様です。
<figure class="center">
    <img src="../../img/get_start32.png" width="100%" height="100%"/> 
</figure>
</p>
<h1 id="コードの記述">コードの記述</h1>
<p>各種ペリフェラルの設定ができたのでコードを記述していきます。</p>
<div class="highlight"><pre style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-c++" data-lang="c++"><span style="color:#09f;font-style:italic">/*
</span><span style="color:#09f;font-style:italic"> * Copyright 2016-2020 NXP
</span><span style="color:#09f;font-style:italic"> * All rights reserved.
</span><span style="color:#09f;font-style:italic"> *
</span><span style="color:#09f;font-style:italic"> * Redistribution and use in source and binary forms, with or without modification,
</span><span style="color:#09f;font-style:italic"> * are permitted provided that the following conditions are met:
</span><span style="color:#09f;font-style:italic"> *
</span><span style="color:#09f;font-style:italic"> * o Redistributions of source code must retain the above copyright notice, this list
</span><span style="color:#09f;font-style:italic"> *   of conditions and the following disclaimer.
</span><span style="color:#09f;font-style:italic"> *
</span><span style="color:#09f;font-style:italic"> * o Redistributions in binary form must reproduce the above copyright notice, this
</span><span style="color:#09f;font-style:italic"> *   list of conditions and the following disclaimer in the documentation and/or
</span><span style="color:#09f;font-style:italic"> *   other materials provided with the distribution.
</span><span style="color:#09f;font-style:italic"> *
</span><span style="color:#09f;font-style:italic"> * o Neither the name of NXP Semiconductor, Inc. nor the names of its
</span><span style="color:#09f;font-style:italic"> *   contributors may be used to endorse or promote products derived from this
</span><span style="color:#09f;font-style:italic"> *   software without specific prior written permission.
</span><span style="color:#09f;font-style:italic"> *
</span><span style="color:#09f;font-style:italic"> * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS &#34;AS IS&#34; AND
</span><span style="color:#09f;font-style:italic"> * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
</span><span style="color:#09f;font-style:italic"> * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
</span><span style="color:#09f;font-style:italic"> * DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR
</span><span style="color:#09f;font-style:italic"> * ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
</span><span style="color:#09f;font-style:italic"> * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
</span><span style="color:#09f;font-style:italic"> * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON
</span><span style="color:#09f;font-style:italic"> * ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
</span><span style="color:#09f;font-style:italic"> * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
</span><span style="color:#09f;font-style:italic"> * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
</span><span style="color:#09f;font-style:italic"> */</span>
 
<span style="color:#09f;font-style:italic">/**
</span><span style="color:#09f;font-style:italic"> * @file    switch_test.c
</span><span style="color:#09f;font-style:italic"> * @brief   Application entry point.
</span><span style="color:#09f;font-style:italic"> */</span>
<span style="color:#099">#include</span> <span style="color:#099">&lt;stdio.h&gt;</span><span style="color:#099">
</span><span style="color:#099">#include</span> <span style="color:#099">&#34;board.h&#34;</span><span style="color:#099">
</span><span style="color:#099">#include</span> <span style="color:#099">&#34;peripherals.h&#34;</span><span style="color:#099">
</span><span style="color:#099">#include</span> <span style="color:#099">&#34;pin_mux.h&#34;</span><span style="color:#099">
</span><span style="color:#099">#include</span> <span style="color:#099">&#34;clock_config.h&#34;</span><span style="color:#099">
</span><span style="color:#099">#include</span> <span style="color:#099">&#34;MIMXRT1011.h&#34;</span><span style="color:#099">
</span><span style="color:#099">#include</span> <span style="color:#099">&#34;fsl_debug_console.h&#34;</span><span style="color:#099">
</span><span style="color:#099"></span><span style="color:#09f;font-style:italic">/* TODO: insert other include files here. */</span>

<span style="color:#09f;font-style:italic">/* TODO: insert other definitions and declarations here. */</span>

<span style="color:#09f;font-style:italic">/*
</span><span style="color:#09f;font-style:italic"> * @brief   Application entry point.
</span><span style="color:#09f;font-style:italic"> */</span>
<span style="color:#099">#define DEBOUNCE_TIME       0.02 </span><span style="color:#09f;font-style:italic">// 0.02s
</span><span style="color:#09f;font-style:italic"></span><span style="color:#099">#define SAMPLE_FREQUENCY    1000 </span><span style="color:#09f;font-style:italic">// 1msに一回サンプリング(PITに依存)
</span><span style="color:#09f;font-style:italic"></span><span style="color:#099">#define MAXIMUM         	(DEBOUNCE_TIME * SAMPLE_FREQUENCY)</span><span style="color:#09f;font-style:italic">//integratorの最大値が決まる
</span><span style="color:#09f;font-style:italic"></span><span style="color:#099">#define SW_ON  0
</span><span style="color:#099">#define SW_OFF 1
</span><span style="color:#099"></span><span style="color:#078;font-weight:bold">uint32_t</span> input;<span style="color:#09f;font-style:italic">//スイッチ入力
</span><span style="color:#09f;font-style:italic"></span><span style="color:#078;font-weight:bold">uint32_t</span> integrator;<span style="color:#09f;font-style:italic">//ONカウント
</span><span style="color:#09f;font-style:italic"></span><span style="color:#078;font-weight:bold">uint32_t</span> output;<span style="color:#09f;font-style:italic">//出力
</span><span style="color:#09f;font-style:italic"></span><span style="color:#078;font-weight:bold">uint32_t</span> counter;<span style="color:#09f;font-style:italic">//長押し判定用
</span><span style="color:#09f;font-style:italic"></span><span style="color:#078;font-weight:bold">uint32_t</span> old_output <span style="color:#555">=</span> <span style="color:#f60">0</span>;
<span style="color:#078;font-weight:bold">uint32_t</span> state <span style="color:#555">=</span> <span style="color:#f60">0</span>;

<span style="color:#078;font-weight:bold">void</span> <span style="color:#c0f">ScanSwitch_Task</span>(){
	input <span style="color:#555">=</span> GPIO_PinRead(GPIO2,<span style="color:#f60">5</span>); <span style="color:#09f;font-style:italic">// 入力をスキャン
</span><span style="color:#09f;font-style:italic"></span>	<span style="color:#069;font-weight:bold">if</span> (input <span style="color:#555">==</span> SW_OFF)
	{
		<span style="color:#069;font-weight:bold">if</span> (integrator <span style="color:#555">&gt;</span> <span style="color:#f60">0</span>){<span style="color:#09f;font-style:italic">//入力がLOWだったら
</span><span style="color:#09f;font-style:italic"></span>		  integrator<span style="color:#555">--</span>;
		}
	}
	<span style="color:#069;font-weight:bold">else</span> <span style="color:#069;font-weight:bold">if</span> (integrator <span style="color:#555">&lt;</span> MAXIMUM){
		integrator<span style="color:#555">++</span>;
	}

	<span style="color:#069;font-weight:bold">if</span> (integrator <span style="color:#555">==</span> <span style="color:#f60">0</span>){
		output <span style="color:#555">=</span> <span style="color:#f60">0</span>;
		counter <span style="color:#555">=</span> <span style="color:#f60">0</span>;
	}
	<span style="color:#069;font-weight:bold">else</span> <span style="color:#069;font-weight:bold">if</span> (integrator <span style="color:#555">&gt;=</span> MAXIMUM)
	{
	output <span style="color:#555">=</span> <span style="color:#f60">1</span>;
	counter<span style="color:#555">++</span>;
	integrator <span style="color:#555">=</span> MAXIMUM;  <span style="color:#09f;font-style:italic">/* defensive code if integrator got corrupted */</span>
	}
}

<span style="color:#078;font-weight:bold">void</span> <span style="color:#c0f">LedTask</span>(){
	<span style="color:#069;font-weight:bold">if</span>(output <span style="color:#555">==</span> <span style="color:#f60">1</span> <span style="color:#555">&amp;&amp;</span> old_output <span style="color:#555">==</span> <span style="color:#f60">0</span>){
	    		state <span style="color:#555">=</span> <span style="color:#555">!</span>state;
	    	}
	    	old_output <span style="color:#555">=</span> output;

	    	<span style="color:#069;font-weight:bold">if</span>(state <span style="color:#555">==</span> <span style="color:#f60">1</span>){
	    		GPIO_PinWrite(GPIO1, <span style="color:#f60">11</span>, <span style="color:#f60">1</span>);

	    	}
	    	<span style="color:#069;font-weight:bold">else</span>{
	    		GPIO_PinWrite(GPIO1, <span style="color:#f60">11</span>, <span style="color:#f60">0</span>);
	    	}
}

<span style="color:#09f;font-style:italic">/* PIT_IRQn interrupt handler */</span>
<span style="color:#078;font-weight:bold">void</span> <span style="color:#c0f">PIT_IRQHANDLER</span>(<span style="color:#078;font-weight:bold">void</span>) {
	<span style="color:#09f;font-style:italic">/*  Place your code here */</span>
	<span style="color:#09f;font-style:italic">/* Add for ARM errata 838869, affects Cortex-M4, Cortex-M4F
</span><span style="color:#09f;font-style:italic">	 Store immediate overlapping exception return operation might vector to incorrect interrupt. */</span>
	ScanSwitch_Task();
	LedTask();
	PIT_ClearStatusFlags(PIT_PERIPHERAL, PIT_CHANNEL_0,kPIT_TimerFlag);
	<span style="color:#099">#if defined __CORTEX_M &amp;&amp; (__CORTEX_M == 4U)
</span><span style="color:#099"></span>	__DSB();
	<span style="color:#099">#endif
</span><span style="color:#099"></span>}


<span style="color:#078;font-weight:bold">int</span> <span style="color:#c0f">main</span>(<span style="color:#078;font-weight:bold">void</span>) {

  	<span style="color:#09f;font-style:italic">/* Init board hardware. */</span>
    BOARD_InitBootPins();
    BOARD_InitBootClocks();
    BOARD_InitBootPeripherals();
  	<span style="color:#09f;font-style:italic">/* Init FSL debug console. */</span>
    BOARD_InitDebugConsole();

    PRINTF(<span style="color:#c30">&#34;Hello World</span><span style="color:#c30;font-weight:bold">\n</span><span style="color:#c30">&#34;</span>);

    <span style="color:#09f;font-style:italic">/* Force the counter to be placed into memory. */</span>
    <span style="color:#09f;font-style:italic">/* Enter an infinite loop, just incrementing a counter. */</span>
    <span style="color:#069;font-weight:bold">while</span>(<span style="color:#f60">1</span>) {

    }
    <span style="color:#069;font-weight:bold">return</span> <span style="color:#f60">0</span> ;
}

</code></pre></div><p>ScanSwitch_Taskの中でチャタリング除去を行っています。
今回はMAXIMUMが20となるように値をセットしていますが、GPIOのスキャン周期(PITのインターバル設定)を変更した場合は調整してください。</p>
<p>LedTaskでは、自己保持の記述をしています。具体的にはスイッチを押したらLEDが付き続け、もう一度押すとLEDが消えるという動作です。</p>
<p>今回は使っていませんがcounterという変数を追加しているため長押しの検出もできます。</p>
<p>チャタリング対策に関してはRefにもリンクを張りましたがDEBOUNCE CODEのKENNETH KUHNさんが実装されたものをカスタマイズして使用しています。</p>
<h1 id="実行とデバッグ">実行とデバッグ</h1>
<p>プログラムの記述ができたのでビルドを行いボードにプログラムを書き込み実行します。。</p>
<p>ボード上のタクトスイッチを押すごとにLEDがついたり消えたりすることが確認できると思います。</p>
<p>次にデバッグをしてみます。
今回はGlobal Variablesというオンタイムで変数の値を確認できるデバッグ機能を使ってみます。</p>
<figure class="center">
    <img src="../../img/get_start33.png" width="100%" height="100%"/> 
</figure>

<p>Global Variablesは、画像を参考に開いてください。<br>
次にデバッガを立ち上げます。Global Variablesのウィンドウ内のメガネのアイコンをクリックし、変数選択を行います。<br>
ここでは、counter,integratorを選択します。</p>
<figure class="center">
    <img src="../../img/get_start34.png" width="100%" height="100%"/> 
</figure>

<p>変数のチェックを有効にし、更新頻度を500msに設定します。<br>
最後に再生ボタンをクリックするとオンタイムで変数の変化が見れるようになります。</p>
<p><figure class="center">
    <img src="../../img/get_start35.png" width="100%" height="100%"/> 
</figure>

ボード上のタクトスイッチを長押ししてみてください。<br>
画像のように長押ししている間counter変数が増加する様子が確認できます。</p>
<h1 id="まとめ">まとめ</h1>
<p>Getting start(1) ~ (4)で学んできたことを組み合わせることで一つのアプリケーションを組むことを体験しました。</p>
<p>各種コンフィグ機能を使って開発を行うことで複数ペリフェラルを組み合わせた際でも少ない労力でアプリケーションを作成可能であること、IDEの強力なデバッグ機能を駆使することで効率的な開発が可能であることを学べたと思います。</p>
<p>以上でGetting startシリーズは終了しますが、その他のTips記事などを読むことで更に上位レベルの開発を行う事ができるようになります。</p>
<p>今回学んだMCUXpressoのPins,Clocks,Peripheralsの機能は今後の開発にも重要なツールになっていますので記事を読み返して復習したりご自分で新しいペリフェラルに挑戦するなりして知見を増やしていただけたら幸いです。</p>
<h1 id="ref">Ref</h1>
<ul>
<li><a href="https://www.marutsu.co.jp/pc/static/large_order/1405_311_ph">スイッチのチャタリングとは</a></li>
<li><a href="https://hackaday.com/2010/11/09/debounce-code-one-post-to-rule-them-all/">DEBOUNCE CODE – ONE POST TO RULE THEM ALL</a></li>
</ul>
        </p>
    </div>
    

    

    <div class="page-footer">
        
        <hr class="footer-divider">
        
            <a class="tag" href="/tags/rt1010">#RT1010</a>
        
      
    </div>


        

<link rel="stylesheet" type="text/css" href="/mimxrt_docs/css/katex.min.css" crossorigin="anonymous">
<script type="text/javascript" src="/mimxrt_docs/js/katex.min.js" crossorigin="anonymous"></script>
<script type="text/javascript" src="/mimxrt_docs/js/auto-render.min.js"onload="renderMathInElement(document.body);" crossorigin="anonymous"></script>

        </div>
        <footer class="footer-mobile">
	<div class="social-icons">
        

    

    
    <a class="social-icon" href="https://twitter.com/onagawadosu" target="_blank" rel="noopener" title="Twitter">
        <svg width="28px" height="28px" viewBox="0 0 28 28" version="1.1" fill="#ABABAB" xmlns="https://www.w3.org/2000/svg" xmlns:xlink="https://www.w3.org/1999/xlink">
            <path d="M8.991284,24.971612 C19.180436,24.971612 24.752372,16.530224 24.752372,9.210524 C24.752372,8.970656 24.747512,8.731868 24.736496,8.494376 C25.818008,7.712564 26.758256,6.737 27.5,5.62622 C26.507372,6.067076 25.439252,6.364292 24.318752,6.498212 C25.462472,5.812628 26.340512,4.727444 26.754584,3.434036 C25.684088,4.068536 24.499004,4.53002 23.23724,4.778528 C22.226468,3.701876 20.786828,3.028388 19.193828,3.028388 C16.134404,3.028388 13.653536,5.509256 13.653536,8.567492 C13.653536,9.0023 13.702244,9.424904 13.797176,9.830552 C9.19346,9.599108 5.11106,7.39472 2.3792,4.04294 C1.903028,4.861364 1.629032,5.812628 1.629032,6.827072 C1.629032,8.74904 2.606972,10.445612 4.094024,11.438132 C3.185528,11.41016 2.331788,11.160464 1.585184,10.745096 C1.583888,10.768208 1.583888,10.791428 1.583888,10.815728 C1.583888,13.49888 3.493652,15.738584 6.028088,16.246508 C5.562932,16.373084 5.07326,16.44134 4.56782,16.44134 C4.210988,16.44134 3.863876,16.406024 3.526484,16.34144 C4.231724,18.542264 6.276596,20.143796 8.701412,20.18894 C6.805148,21.674696 4.416836,22.56008 1.821488,22.56008 C1.374476,22.56008 0.93362,22.534592 0.5,22.4834 C2.951708,24.054476 5.862524,24.971612 8.991284,24.971612"></path>
        </svg>
    </a>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
    
    
    <a class="social-icon" href="https://github.com/TakeshiOnagawa" target="_blank" rel="noopener" title="GitHub">
        <svg width="28px" height="28px" viewBox="0 0 28 28" version="1.1" fill="#ABABAB" xmlns="https://www.w3.org/2000/svg" xmlns:xlink="https://www.w3.org/1999/xlink">
            <path d="M13.9988029,1.32087331 C6.82105037,1.32087331 1,7.14112562 1,14.3212723 C1,20.0649109 4.72454649,24.9370678 9.89038951,26.6560892 C10.5408085,26.7757983 10.7778323,26.374374 10.7778323,26.0296121 C10.7778323,25.7215609 10.7666595,24.9035493 10.760275,23.8189856 C7.14426471,24.6042767 6.38131925,22.0760223 6.38131925,22.0760223 C5.78995672,20.5740732 4.93762853,20.1742451 4.93762853,20.1742451 C3.75729765,19.3682044 5.02701126,19.3841656 5.02701126,19.3841656 C6.33183953,19.4759425 7.01817121,20.7241085 7.01817121,20.7241085 C8.17775254,22.7104801 10.0611744,22.1366749 10.8017741,21.8038838 C10.919887,20.9643246 11.2558703,20.3913175 11.6269683,20.066507 C8.74038491,19.7385043 5.70536235,18.6228163 5.70536235,13.6413251 C5.70536235,12.2223743 6.21213051,11.0611968 7.04370914,10.1530044 C6.90963504,9.82420367 6.46351945,8.50181809 7.17139875,6.71256734 C7.17139875,6.71256734 8.26234691,6.36301702 10.7459099,8.04532771 C11.78259,7.75642995 12.8950858,7.61277914 14.000399,7.60719272 C15.1049142,7.61277914 16.2166119,7.75642995 17.2548881,8.04532771 C19.736855,6.36301702 20.8262071,6.71256734 20.8262071,6.71256734 C21.5356825,8.50181809 21.0895669,9.82420367 20.9562909,10.1530044 C21.7894656,11.0611968 22.2922435,12.2223743 22.2922435,13.6413251 C22.2922435,18.6355852 19.2524325,19.734514 16.3570705,20.0561322 C16.8231376,20.4575564 17.2389269,21.2508282 17.2389269,22.4638795 C17.2389269,24.2012564 17.2229657,25.603448 17.2229657,26.0296121 C17.2229657,26.3775663 17.4575954,26.7821827 18.116793,26.6552912 C23.2786458,24.9322794 27,20.0633148 27,14.3212723 C27,7.14112562 21.1789496,1.32087331 13.9988029,1.32087331"></path>
        </svg>
    </a>
    

    
    
    

    

    

    

    

    

</div>




	<div class="footer-mobile-links">
		<p><a href="https://github.com/kimcc/hugo-theme-noteworthy" target="_blank" rel="noopener">Noteworthy theme</a></p>
		<span class="divider-bar">|</span>
		<p><a href="https://gohugo.io" target="_blank" rel="noopener">Built with Hugo</a></p>
	</div>

	<script src="https://takeshionagawa.github.io/mimxrt_docs/js/main.min.fa5c2b23e07b5d9bfad267a52b4b24fdb053e6fb7524993383594926a3ac270c.js" integrity="sha256-+lwrI+B7XZv60melK0sk/bBT5vt1JJkzg1lJJqOsJww=" crossorigin="anonymous"></script>
</footer>
    </body>
</html>